<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WLSQB5SF');</script>
    <!-- End Google Tag Manager -->

    <!-- GA4 Network Hit Interceptor Script START -->
    <script>
        // --- GA4 Network Hit Interceptor Script ---
        window.capturedGa4EventNames = window.capturedGa4EventNames || [];
        const MAX_DISPLAYED_EVENTS_IN_CONSOLE = 3;
        const MAX_STORED_EVENTS_IN_MEMORY = 20;
        let networkInterceptorInitialized = false;

        function updateCustomConsoleDisplayFromNetwork() {
            const eventDisplaySpan = document.getElementById('console-message-gtm');
            if (!eventDisplaySpan) { return; }
            if (window.capturedGa4EventNames.length > 0) {
                eventDisplaySpan.textContent = window.capturedGa4EventNames.slice(-MAX_DISPLAYED_EVENTS_IN_CONSOLE).join(', ');
            } else {
                eventDisplaySpan.textContent = "(Waiting for GA4 hits...)";
            }
        }

        function recordGa4EventFromNetwork(eventName, source, details) { 
            if (typeof eventName !== 'string' || !eventName) return;
            console.log(`%c[NetworkInterceptor] GA4 Event from Hit: "${eventName}" (Source: ${source})`, "color: #008080; font-weight: bold;", details);
            window.capturedGa4EventNames.push(eventName);
            if (window.capturedGa4EventNames.length > MAX_STORED_EVENTS_IN_MEMORY) {
                window.capturedGa4EventNames.shift();
            }
            updateCustomConsoleDisplayFromNetwork();
        }

        function parseAndLogGa4HitParameters(urlString, requestBody, source) {
            try {
                const url = new URL(urlString, window.location.origin); // Ensure URL is absolute for parsing
                if (!url.hostname.endsWith('google-analytics.com') || !url.pathname.includes('/g/collect')) {
                    return; // Not a GA4 collect endpoint
                }

                let allParams = new URLSearchParams(url.search); // Get params from URL query string

                // Attempt to parse requestBody if it's a string (common for XHR send & fetch body)
                if (requestBody && typeof requestBody === 'string') {
                    try {
                        const bodyParams = new URLSearchParams(requestBody);
                        bodyParams.forEach((value, key) => {
                            allParams.append(key, value); // Append, or set if you prefer override
                        });
                    } catch (e) {
                        console.warn('[NetworkInterceptor] Could not parse requestBody as URLSearchParams:', requestBody, e);
                    }
                } else if (requestBody instanceof URLSearchParams) {
                     requestBody.forEach((value, key) => {
                        allParams.append(key,value);
                     });
                }
                // Note: More complex body types (FormData, Blob, ArrayBuffer) are not handled here for simplicity.
                // gtag.js typically uses string bodies for POST to /g/collect.

                const ga4EventName = allParams.get('en');
                const measurementId = allParams.get('tid');

                if (ga4EventName) {
                    recordGa4EventFromNetwork(ga4EventName, source, { 
                        tid: measurementId, 
                        url: urlString, 
                        // allParams: allParams.toString() // Can be very verbose
                    });
                } else if (measurementId && allParams.get('v') === '2') {
                    // If it's a GA4 hit (v=2) but no 'en', it might be a basic page_view from config
                    // or other non-event hit. GTM Preview shows "page_view" for config hits.
                    // We can infer 'page_view' if 'en' is missing but it's a GA4 config-like hit.
                    // This is an assumption, as config hits don't always explicitly have en=page_view.
                    let isLikelyConfigHit = false;
                    allParams.forEach((value, key) => {
                        if (key.startsWith('_p') || key === 'dl' || key === 'dt') isLikelyConfigHit = true;
                    });
                    if (isLikelyConfigHit && !allParams.has('en')) { // Check if 'en' is truly missing
                         recordGa4EventFromNetwork('page_view', `${source} (config inferred)`, { tid: measurementId, url: urlString });
                    }
                }
            } catch (e) {
                console.error('[NetworkInterceptor] Error parsing GA4 hit:', e, urlString, requestBody);
            }
        }

        function initializeNetworkInterceptor() {
            if (networkInterceptorInitialized) return;
            networkInterceptorInitialized = true;
            console.log('[NetworkInterceptor] Initializing...');

            // --- Wrap XMLHttpRequest ---
            if (typeof XMLHttpRequest !== 'undefined' && XMLHttpRequest.prototype && XMLHttpRequest.prototype.send) {
                const originalXHROpen = XMLHttpRequest.prototype.open;
                const originalXHRSend = XMLHttpRequest.prototype.send;
                let xhrRequestURL = ''; // Store URL from open to use in send

                XMLHttpRequest.prototype.open = function(method, url, ...restArgs) {
                    if (typeof url === 'string') {
                        xhrRequestURL = url; // Capture URL
                    }
                    return originalXHROpen.apply(this, [method, url, ...restArgs]);
                };

                XMLHttpRequest.prototype.send = function(body) {
                    if (xhrRequestURL) { // If we have a URL from a recent .open() call
                        // console.log('[NetworkInterceptor] XHR Send. URL:', xhrRequestURL, 'Body:', body);
                        parseAndLogGa4HitParameters(xhrRequestURL, body, 'XHR');
                        xhrRequestURL = ''; // Clear for next XHR
                    }
                    return originalXHRSend.apply(this, arguments);
                };
                console.log('[NetworkInterceptor] XMLHttpRequest wrapped.');
            } else {
                console.warn('[NetworkInterceptor] XMLHttpRequest not available for wrapping.');
            }

            // --- Wrap fetch ---
            if (typeof window.fetch === 'function') {
                const originalFetch = window.fetch;
                window.fetch = function(input, init) {
                    let urlString = (typeof input === 'string') ? input : (input instanceof Request ? input.url : '');
                    let requestBody = init ? init.body : (input instanceof Request ? input.body : null); // body can be stream
                    
                    // console.log('[NetworkInterceptor] Fetch call. URL:', urlString, 'Body given to fetch:', requestBody);
                    
                    // If body is a ReadableStream, we can't easily inspect it synchronously here.
                    // gtag.js for /g/collect usually sends a string or URLSearchParams in the body for POST.
                    // We'll proceed with what we have. If body is a stream, parseAndLog will likely not find params in it.
                    parseAndLogGa4HitParameters(urlString, requestBody, 'Fetch');
                    
                    return originalFetch.apply(this, arguments);
                };
                console.log('[NetworkInterceptor] Fetch wrapped.');
            } else {
                console.warn('[NetworkInterceptor] Fetch not available for wrapping.');
            }
            updateCustomConsoleDisplayFromNetwork(); // Initial display
        }

        // Initialize as early as possible
        if (document.readyState === 'loading') {
            initializeNetworkInterceptor();
        } else {
            // If DOM is already interactive or complete
            initializeNetworkInterceptor();
        }

        document.addEventListener('DOMContentLoaded', () => {
            updateCustomConsoleDisplayFromNetwork(); // Ensure display is set
            // console.log('[NetworkInterceptor] DOMContentLoaded.');
        });
    </script>
    <!-- GA4 Network Hit Interceptor Script END -->
     
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">

    <!-- Scripts -->
    <!-- <script src="js/gtm-ga4-interceptor.js?v=1"></script> -->
    <script src="js/config.js?v=3" defer></script>
    <script src="js/global-submit-handler.js?v=2" defer></script>

</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLSQB5SF"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header>
        <div id="logo" class="logo">
            <img src="images/favicon.png" alt="Site Logo" class="logo-icon">
            Demo
        </div>
        <nav class="header-nav"> 
            <a href="#newsletter" class="header-link">Newsletter</a>
            <a href="contact.html" class="header-link">Contact</a>
        </nav>
    </header>
    
    <div class="content">

        <section id="hero" class="block" style="background-color: #fe6d6d;">
            <h1>Hero</h1>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
                <a href="contact.html"  class="cta-2">Contact us</a>
            </div>
        </section>

        <section id="social-proof" class="block" style="background-color: #fe946d;">
            <h2>Social Proof</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="problem" class="block" style="background-color: #ffcd4f;">
            <h2>Problem</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="solution" class="block" style="background-color: #56c98f;">
            <h2>Solution</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="case-study" class="block" style="background-color: #5cc1d7;">
            <h2>Case Study</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="faq" class="block" style="background-color: #8ea5fa;">
            <h2>FAQ</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="video" class="block" style="background-color: #f097fc;">
            <h2>Video</h2>

            <div class="iframe-wrapper" style="padding-top: 3rem;">
                <iframe 
                    src="https://www.youtube.com/embed/3apbS5OBuaA?enablejsapi=1" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    referrerpolicy="strict-origin-when-cross-origin" 
                    allowfullscreen
                    id="video-iframe">
                </iframe>
            </div>
            
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="lead" class="block" style="background-color: #fc97c6;">
            <h2>Lead Form</h2>
            <form id="form-lead" 
                  action="" method="post"
                  class="form-1" 
                  style="padding-top: 3rem;">
                <label for="phone">Phone</label>
                <input name="form-id" type="hidden" value="form-lead">
                <input id="phone" type="tel" name="phone" placeholder="+1 (555) 123-4567" required>
                <label for="email">Email</label>
                <input id="email" type="email" name="email" placeholder="john.doe@example.com" required>
                <label for="company">Company</label>
                <input id="company" type="text" name="company" placeholder="Acme Corp." required>
                <label for="message">Message</label>
                <textarea id="message" name="message" placeholder="I'm interested in your services." rows="4" required></textarea>
                <button id="form-lead-button" type="submit" class="form-1-button-submit">Lead submit</button>
            </form>
        </section>

        <section id="newsletter" class="block" style="background-color: #fc9797;">
            <h2>Newsletter Form</h2>
            <div class="card-group" style="display: none;">
                <div id="message-newsletter" class="card message-success">
                </div>
            </div>
            <form id="form-newsletter"
                  action="" method="post" 
                  class="form-1" 
                  style="padding-top: 3rem;">
                <label for="email">Email</label>
                <input name="form-id" type="hidden" value="form-newsletter">
                <input id="email" type="email" name="email" placeholder="john.doe@example.com" required>
                <button id="form-newsletter-button" type="submit" class="form-1-button-submit">Newsletter submit</button>
            </form>
        </section>

       <footer>
            <h2>Footer</h2>
            <div class="cta-group">
                <a href="#logo" class="cta-1">Back to top</a>
            </div>
       </footer>

    </div>

    <div class="console">
        <span id="console-message">
            <b>Last events:</b> 
            <span id="console-message-gtm">
                form-submit, scroll, click
            </span>
        </span>
    </div>

    <script>
        // Newsletter AJAX form submission
        document.addEventListener('DOMContentLoaded', () => {
            const newsletterForm = document.getElementById('form-newsletter');
            const newsletterMessageDiv = document.getElementById('message-newsletter');
            const submitButton = newsletterForm ? newsletterForm.querySelector('button[type="submit"]') : null;
            const messageContainer = newsletterMessageDiv ? newsletterMessageDiv.parentElement : null;

            if (newsletterForm && newsletterMessageDiv && submitButton && messageContainer) {
                newsletterForm.addEventListener('submit', function(event) {
                    event.preventDefault(); 

                    const formData = new FormData(newsletterForm);
                    const actionUrl = newsletterForm.getAttribute('action');

                    // Reset message area: hide container, clear text, set base class
                    if (messageContainer) {
                        messageContainer.style.display = 'none'; 
                    }
                    newsletterMessageDiv.textContent = '';
                    newsletterMessageDiv.className = 'card'; // Base class
                    submitButton.disabled = true;
                    submitButton.textContent = 'Submitting...';

                    if (!actionUrl || actionUrl.trim() === '') {
                        newsletterMessageDiv.textContent = 'Error: Form submission endpoint is not configured.';
                        newsletterMessageDiv.classList.add('message-error'); // Add error class
                        if (messageContainer) {
                            messageContainer.style.display = 'block'; 
                        }
                        submitButton.disabled = false;
                        submitButton.textContent = 'Newsletter submit';
                        return;
                    }

                    fetch(actionUrl, {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => {
                        return response.text().then(text => {
                            if (!response.ok) {
                                // For !response.ok, create an Error object that includes the response text
                                let error = new Error(`Server error: ${response.status} ${response.statusText}.`);
                                error.responseText = text; // Attach the response text to the error object
                                throw error;
                            }
                            return text; // This is the success message from the webhook
                        });
                    })
                    .then(responseText => {
                        newsletterMessageDiv.textContent = responseText;
                        newsletterMessageDiv.classList.add('message-success'); // Add success class
                        if (messageContainer) {
                            messageContainer.style.display = 'block';
                        }
                        newsletterForm.reset(); 
                    })
                    .catch(error => {
                        console.error('Newsletter AJAX submission error:', error);
                        // If error has responseText (from !response.ok), use it. Otherwise, use error.message or a generic fallback.
                        newsletterMessageDiv.textContent = error.responseText || error.message || 'Submission failed. Please try again.';
                        newsletterMessageDiv.classList.add('message-error'); // Add error class
                        if (messageContainer) {
                            messageContainer.style.display = 'block'; 
                        }
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Newsletter submit';
                    });
                });
            } else {
                if (!newsletterForm) console.error('Newsletter form (form-newsletter) not found.');
                if (!newsletterMessageDiv) console.error('Newsletter message div (message-newsletter) not found.');
                if (!submitButton) console.error('Newsletter submit button not found.');
                if (!messageContainer) console.error('Message container (parent of message-newsletter) not found.');
            }
        });
    </script>

</body>
</html>