<!DOCTYPE html>
<html lang="en">
<head>

    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-WLSQB5SF');</script>
    <!-- End Google Tag Manager -->

    <!-- GA4 Network Hit Interceptor Script START -->
    <script>
        // --- GA4 Network Hit Interceptor Script ---
        // Version: 2025-06-22-A (handles POST with empty body, params in URL)
        window.capturedGa4EventNames = window.capturedGa4EventNames || [];
        const MAX_DISPLAYED_EVENTS_IN_CONSOLE = 3;
        const MAX_STORED_EVENTS_IN_MEMORY = 20;
        let networkInterceptorInitialized = false;

        function updateCustomConsoleDisplayFromNetwork() {
            const eventDisplaySpan = document.getElementById('console-message-gtm');
            if (!eventDisplaySpan) { return; }
            if (window.capturedGa4EventNames.length > 0) {
                eventDisplaySpan.textContent = window.capturedGa4EventNames.slice(-MAX_DISPLAYED_EVENTS_IN_CONSOLE).join(', ');
            } else {
                eventDisplaySpan.textContent = "(Waiting for GA4 hits...)";
            }
        }

        function recordGa4EventFromNetwork(eventName, source, details) { 
            if (typeof eventName !== 'string' || !eventName) return;
            console.log(`%c[NetworkInterceptor] GA4 Event from Hit: "${eventName}" (Source: ${source})`, "color: #008080; font-weight: bold;", details);
            window.capturedGa4EventNames.push(eventName);
            if (window.capturedGa4EventNames.length > MAX_STORED_EVENTS_IN_MEMORY) {
                window.capturedGa4EventNames.shift();
            }
            updateCustomConsoleDisplayFromNetwork();
        }

        function parseAndLogGa4HitParameters(urlString, requestBody, source) {
            try {
                // Ensure urlString is valid before creating URL object
                if (!urlString || typeof urlString !== 'string' || (!urlString.startsWith('http:') && !urlString.startsWith('https:'))) {
                    // console.warn('[NetworkInterceptor] Invalid URL string provided:', urlString);
                    return;
                }

                const url = new URL(urlString, window.location.origin);
                if (!url.hostname.endsWith('google-analytics.com') || !url.pathname.includes('/g/collect')) {
                    return; 
                }

                // Start with parameters from the URL's query string
                let combinedParams = new URLSearchParams(url.search); 
                let bodyParamsProcessed = false;

                // If a requestBody exists and is a string, try to parse it
                if (requestBody && typeof requestBody === 'string' && requestBody.trim() !== '') {
                    try {
                        const bodyOnlyParams = new URLSearchParams(requestBody);
                        bodyOnlyParams.forEach((value, key) => {
                            combinedParams.set(key, value); // .set to override query params if same key exists in body
                        });
                        bodyParamsProcessed = true;
                    } catch (e) { 
                        console.warn(`[NetworkInterceptor] Could not parse string requestBody for ${source}:`, requestBody, e);
                    }
                } else if (requestBody instanceof URLSearchParams) {
                     requestBody.forEach((value, key) => {
                        combinedParams.set(key, value);
                     });
                     bodyParamsProcessed = true;
                } else if (requestBody instanceof Blob) {
                    console.log(`[NetworkInterceptor] ${source} body is a Blob. Data not parsed by this basic interceptor.`);
                } else if (requestBody) {
                    // console.log(`[NetworkInterceptor] ${source} body is of type ${typeof requestBody}. Data:`, requestBody);
                }
                
                // console.log(`[NetworkInterceptor] Source: ${source}, URL: ${urlString}, Body Processed: ${bodyParamsProcessed}, Combined Params: ${combinedParams.toString()}`);

                const ga4EventName = combinedParams.get('en');
                const measurementId = combinedParams.get('tid');

                if (ga4EventName) {
                    recordGa4EventFromNetwork(ga4EventName, source, { tid: measurementId, url: urlString });
                } else if (measurementId && combinedParams.get('v') === '2') {
                    // Infer page_view if 'en' is missing but other GA4 params are present
                    let isLikelyConfigHit = false;
                    combinedParams.forEach((value, key) => { 
                        if (key.startsWith('_p') || key === 'dl' || key === 'dt' || key === 'sid' || key === 'sct') isLikelyConfigHit = true; 
                    });
                    if (isLikelyConfigHit && !combinedParams.has('en')) {
                         recordGa4EventFromNetwork('page_view', `${source} (config inferred)`, { tid: measurementId, url: urlString });
                    }
                }
            } catch (e) { console.error('[NetworkInterceptor] Error parsing GA4 hit:', e, "URL:", urlString, "Body:", requestBody); }
        }

        function initializeNetworkInterceptor() {
            if (networkInterceptorInitialized) return;
            networkInterceptorInitialized = true;
            console.log('[NetworkInterceptor] Initializing...');

            // --- Wrap XMLHttpRequest ---
            if (typeof XMLHttpRequest !== 'undefined' && XMLHttpRequest.prototype && XMLHttpRequest.prototype.send) {
                const originalXHROpen = XMLHttpRequest.prototype.open;
                const originalXHRSend = XMLHttpRequest.prototype.send;
                // Use a property on the XHR instance itself to store its URL
                const xhrUrlSymbol = Symbol ? Symbol('xhrUrl') : '__xhrUrl';


                XMLHttpRequest.prototype.open = function(method, url, ...restArgs) {
                    let urlString = '';
                    if (typeof url === 'string') { urlString = url; } 
                    else if (url instanceof URL) { urlString = url.toString(); }
                    this[xhrUrlSymbol] = urlString; // Store URL on the instance
                    return originalXHROpen.apply(this, [method, url, ...restArgs]);
                };

                XMLHttpRequest.prototype.send = function(body) {
                    const urlFromOpen = this[xhrUrlSymbol];
                    if (urlFromOpen) {
                        // console.log('[NetworkInterceptor] XHR Send. URL:', urlFromOpen, 'Body:', body);
                        parseAndLogGa4HitParameters(urlFromOpen, body, 'XHR');
                    }
                    return originalXHRSend.apply(this, arguments);
                };
                console.log('[NetworkInterceptor] XMLHttpRequest wrapped.');
            } else { console.warn('[NetworkInterceptor] XMLHttpRequest not available for wrapping.'); }

            // --- Wrap fetch ---
            if (typeof window.fetch === 'function') {
                const originalFetch = window.fetch;
                window.fetch = function(input, init) {
                    let urlString = '';
                    let requestBody = null; // Hold potential body
                    let method = 'GET'; // Default method

                    if (typeof input === 'string') { 
                        urlString = input; 
                    } else if (input instanceof URL) { 
                        urlString = input.toString(); 
                    } else if (input instanceof Request) { 
                        urlString = input.url; 
                        method = input.method;
                        // Attempt to get body if Request object, but it might be a stream already consumed
                        // For simplicity, we'll mainly rely on init.body if provided.
                        // If input.body is used, it often needs to be cloned if it's a stream and read asynchronously.
                    }

                    if (init) {
                        if(init.method) method = init.method;
                        if(init.body) requestBody = init.body;
                    }
                    
                    // console.log(`[NetworkInterceptor] Fetch call. Method: ${method}, URL: ${urlString}`, init || '');
                    parseAndLogGa4HitParameters(urlString, requestBody, 'Fetch');
                    
                    return originalFetch.apply(this, arguments);
                };
                console.log('[NetworkInterceptor] Fetch wrapped.');
            } else { console.warn('[NetworkInterceptor] Fetch not available for wrapping.'); }

            // --- Wrap navigator.sendBeacon ---
            if (navigator && typeof navigator.sendBeacon === 'function') {
                const originalSendBeacon = navigator.sendBeacon;
                navigator.sendBeacon = function(url, data) {
                    const urlString = (typeof url === 'string') ? url : (url instanceof URL ? url.toString() : '');
                    // console.log('[NetworkInterceptor] navigator.sendBeacon called. URL:', urlString, 'Data type:', typeof data);
                    
                    let dataAsString = null;
                    if (typeof data === 'string') {
                        dataAsString = data;
                    } else if (data instanceof URLSearchParams) {
                        dataAsString = data.toString();
                    } else if (data instanceof Blob) {
                         console.log("[NetworkInterceptor] sendBeacon data is a Blob. Parsing attempt for text types.");
                         // Synchronous blob reading is not possible.
                         // If it's URL encoded form data in a blob, this won't catch it here.
                         // But GA4 often sends POST body as string even with sendBeacon.
                    }
                    parseAndLogGa4HitParameters(urlString, dataAsString, 'Beacon');
                    return originalSendBeacon.apply(this, arguments);
                };
                console.log('[NetworkInterceptor] navigator.sendBeacon wrapped.');
            } else {
                console.warn('[NetworkInterceptor] navigator.sendBeacon not available for wrapping.');
            }

            updateCustomConsoleDisplayFromNetwork();
        }

        // Initialize as early as possible
        if (document.readyState === 'loading') {
            initializeNetworkInterceptor();
        } else {
            initializeNetworkInterceptor();
        }
        document.addEventListener('DOMContentLoaded', () => {
            updateCustomConsoleDisplayFromNetwork();
        });
    </script>
    <!-- GA4 Network Hit Interceptor Script END -->
          
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Welcome</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="images/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="192x192" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="images/favicon.png">
    <link rel="icon" type="image/png" sizes="16x16" href="images/favicon.png">

    <!-- Scripts -->
    <!-- <script src="js/gtm-ga4-interceptor.js?v=1"></script> -->
    <script src="js/config.js?v=3" defer></script>
    <script src="js/global-submit-handler.js?v=2" defer></script>

</head>
<body>

    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WLSQB5SF"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <header>
        <div id="logo" class="logo">
            <img src="images/favicon.png" alt="Site Logo" class="logo-icon">
            Demo
        </div>
        <nav class="header-nav"> 
            <a href="#newsletter" class="header-link">Newsletter</a>
            <a href="contact.html" class="header-link">Contact</a>
        </nav>
    </header>
    
    <div class="content">

        <section id="hero" class="block" style="background-color: #fe6d6d;">
            <h1>Hero</h1>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
                <a href="contact.html"  class="cta-2">Contact us</a>
            </div>
        </section>

        <section id="social-proof" class="block" style="background-color: #fe946d;">
            <h2>Social Proof</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="problem" class="block" style="background-color: #ffcd4f;">
            <h2>Problem</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="solution" class="block" style="background-color: #56c98f;">
            <h2>Solution</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="case-study" class="block" style="background-color: #5cc1d7;">
            <h2>Case Study</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="faq" class="block" style="background-color: #8ea5fa;">
            <h2>FAQ</h2>
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="video" class="block" style="background-color: #f097fc;">
            <h2>Video</h2>

            <div class="iframe-wrapper" style="padding-top: 3rem;">
                <iframe 
                    src="https://www.youtube.com/embed/3apbS5OBuaA?enablejsapi=1" 
                    title="YouTube video player" 
                    frameborder="0" 
                    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                    referrerpolicy="strict-origin-when-cross-origin" 
                    allowfullscreen
                    id="video-iframe">
                </iframe>
            </div>
            
            <div class="cta-group">
                <a href="#lead" class="cta-1">Get a quote</a>
            </div>
        </section>

        <section id="lead" class="block" style="background-color: #fc97c6;">
            <h2>Lead Form</h2>
            <form id="form-lead" 
                  action="" method="post"
                  class="form-1" 
                  style="padding-top: 3rem;">
                <label for="phone">Phone</label>
                <input name="form-id" type="hidden" value="form-lead">
                <input id="phone" type="tel" name="phone" placeholder="+1 (555) 123-4567" required>
                <label for="email">Email</label>
                <input id="email" type="email" name="email" placeholder="john.doe@example.com" required>
                <label for="company">Company</label>
                <input id="company" type="text" name="company" placeholder="Acme Corp." required>
                <label for="message">Message</label>
                <textarea id="message" name="message" placeholder="I'm interested in your services." rows="4" required></textarea>
                <button id="form-lead-button" type="submit" class="form-1-button-submit">Lead submit</button>
            </form>
        </section>

        <section id="newsletter" class="block" style="background-color: #fc9797;">
            <h2>Newsletter Form</h2>
            <div class="card-group" style="display: none;">
                <div id="message-newsletter" class="card message-success">
                </div>
            </div>
            <form id="form-newsletter"
                  action="" method="post" 
                  class="form-1" 
                  style="padding-top: 3rem;">
                <label for="email">Email</label>
                <input name="form-id" type="hidden" value="form-newsletter">
                <input id="email" type="email" name="email" placeholder="john.doe@example.com" required>
                <button id="form-newsletter-button" type="submit" class="form-1-button-submit">Newsletter submit</button>
            </form>
        </section>

       <footer>
            <h2>Footer</h2>
            <div class="cta-group">
                <a href="#logo" class="cta-1">Back to top</a>
            </div>
       </footer>

    </div>

    <div class="console">
        <span id="console-message">
            <b>Last events:</b> 
            <span id="console-message-gtm">
                form-submit, scroll, click
            </span>
        </span>
    </div>

    <script>
        // Newsletter AJAX form submission
        document.addEventListener('DOMContentLoaded', () => {
            const newsletterForm = document.getElementById('form-newsletter');
            const newsletterMessageDiv = document.getElementById('message-newsletter');
            const submitButton = newsletterForm ? newsletterForm.querySelector('button[type="submit"]') : null;
            const messageContainer = newsletterMessageDiv ? newsletterMessageDiv.parentElement : null;

            if (newsletterForm && newsletterMessageDiv && submitButton && messageContainer) {
                newsletterForm.addEventListener('submit', function(event) {
                    event.preventDefault(); 

                    const formData = new FormData(newsletterForm);
                    const actionUrl = newsletterForm.getAttribute('action');

                    // Reset message area: hide container, clear text, set base class
                    if (messageContainer) {
                        messageContainer.style.display = 'none'; 
                    }
                    newsletterMessageDiv.textContent = '';
                    newsletterMessageDiv.className = 'card'; // Base class
                    submitButton.disabled = true;
                    submitButton.textContent = 'Submitting...';

                    if (!actionUrl || actionUrl.trim() === '') {
                        newsletterMessageDiv.textContent = 'Error: Form submission endpoint is not configured.';
                        newsletterMessageDiv.classList.add('message-error'); // Add error class
                        if (messageContainer) {
                            messageContainer.style.display = 'block'; 
                        }
                        submitButton.disabled = false;
                        submitButton.textContent = 'Newsletter submit';
                        return;
                    }

                    fetch(actionUrl, {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => {
                        return response.text().then(text => {
                            if (!response.ok) {
                                // For !response.ok, create an Error object that includes the response text
                                let error = new Error(`Server error: ${response.status} ${response.statusText}.`);
                                error.responseText = text; // Attach the response text to the error object
                                throw error;
                            }
                            return text; // This is the success message from the webhook
                        });
                    })
                    .then(responseText => {
                        newsletterMessageDiv.textContent = responseText;
                        newsletterMessageDiv.classList.add('message-success'); // Add success class
                        if (messageContainer) {
                            messageContainer.style.display = 'block';
                        }
                        newsletterForm.reset(); 
                    })
                    .catch(error => {
                        console.error('Newsletter AJAX submission error:', error);
                        // If error has responseText (from !response.ok), use it. Otherwise, use error.message or a generic fallback.
                        newsletterMessageDiv.textContent = error.responseText || error.message || 'Submission failed. Please try again.';
                        newsletterMessageDiv.classList.add('message-error'); // Add error class
                        if (messageContainer) {
                            messageContainer.style.display = 'block'; 
                        }
                    })
                    .finally(() => {
                        submitButton.disabled = false;
                        submitButton.textContent = 'Newsletter submit';
                    });
                });
            } else {
                if (!newsletterForm) console.error('Newsletter form (form-newsletter) not found.');
                if (!newsletterMessageDiv) console.error('Newsletter message div (message-newsletter) not found.');
                if (!submitButton) console.error('Newsletter submit button not found.');
                if (!messageContainer) console.error('Message container (parent of message-newsletter) not found.');
            }
        });
    </script>

</body>
</html>